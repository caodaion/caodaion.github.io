"use strict";(self.webpackChunkpwa=self.webpackChunkpwa||[]).push([[820],{2820:(M,m,o)=>{o.r(m),o.d(m,{NotificationsModule:()=>l});var p=o(6895),d=o(9299),t=o(4650),y=o(2729),N=o(5604),c=o(7084),h=o(6338),r=o(4006);function E(s,n){if(1&s&&(t.TgZ(0,"mat-list-option",6)(1,"span",7),t._uU(2),t.qZA(),t.TgZ(3,"span",8),t._uU(4),t.qZA()()),2&s){const i=n.$implicit;t.Q6J("value",null==i?null:i.key),t.xp6(2),t.Oqu(null==i?null:i.name),t.xp6(2),t.AsE("",null==i?null:i.startTime," - ",null==i?null:i.endTime,"")}}class g{constructor(n,i,e){this.eventService=n,this.datePipe=i,this.commonService=e,this.eventList=[],this.tuthoiEvents=[],this.pushNotificationsSettings={tuThoi:[]}}ngOnInit(){this.getEvents()}getNotificationSettings(){const n=JSON.parse(localStorage.getItem("pushNotification")||"[]");this.pushNotificationsSettings=JSON.parse(localStorage.getItem("pushNotificationsSettings")||"{}"),this.eventList.find(e=>"cung-tu-thoi"===e.key)?.event?.filter(e=>"cung-tu-thoi"!==e.key)?.filter(e=>this.pushNotificationsSettings?.tuThoi?.includes(e?.key))?.forEach(e=>{const f=`Th\xf4ng b\xe1o ${e?.name}`,T=new Date,a=new Date(`${this.datePipe.transform(T,"yyyy-MM-dd")} ${e?.time[0].split("-")[1]?.slice(0,2)}:00:00`);a.setMinutes(a.getMinutes()-10);const C={body:`H\xe3y chu\u1ea9n b\u1ecb ${e?.name} v\xe0o l\xfac ${this.datePipe.transform(a,"HH:mm")}`,data:{url:`${location.origin}/lich/su-kien/cung-thoi-ty`},icon:"assets/icons/windows11/Square150x150Logo.scale-400.png",image:"assets/icons/windows11/Wide310x150Logo.scale-400.png"};Array.from({length:7},(A,v)=>{n.push({key:this.datePipe.transform(a.setDate(a.getDate()+v),"yyyMMddHHmmss"),title:f,payload:C,notificationAt:this.datePipe.transform(new Date(a.setDate(a.getDate()+v)),"yyyy-MM-dd HH:mm:ss")})})}),n?.forEach(e=>{console.log("Pushed Notification For: ",e),this.commonService.pushNotification(e?.title,e?.payload,new Date(e?.notificationAt),!1)})}getEvents(){this.eventService.getEventList().subscribe(n=>{n&&(this.eventList=n.data,this.tuthoiEvents=this.eventList.find(i=>"cung-tu-thoi"===i.key)?.event?.filter(i=>"cung-tu-thoi"!==i.key),this.tuthoiEvents.forEach(i=>{i.startTime=`${i?.time[0].split("-")[1]?.slice(0,2)}:00`,i.endTime=`${i?.time[0].split("-")[1]?.slice(2,4)}:00`}),this.pushNotificationsSettings.tuThoi=this.tuthoiEvents.map(i=>({key:i?.key,name:i?.name,isActive:null})),this.getNotificationSettings())})}selectionChange(){localStorage.setItem("pushNotificationsSettings",JSON.stringify(this.pushNotificationsSettings)),this.getNotificationSettings()}}g.\u0275fac=function(n){return new(n||g)(t.Y36(y.P),t.Y36(p.uU),t.Y36(N.v))},g.\u0275cmp=t.Xpm({type:g,selectors:[["app-notifications"]],decls:13,vars:3,consts:[[1,"container-fluid"],["multi",""],[3,"expanded"],[3,"ngModel","ngModelChange","selectionChange"],["tuThoi",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["matListItemTitle",""],["matListItemLine",""]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"h1"),t._uU(2,"C\xe0i \u0111\u1eb7t th\xf4ng b\xe1o"),t.qZA(),t.TgZ(3,"mat-accordion",1)(4,"mat-expansion-panel",2)(5,"mat-expansion-panel-header")(6,"mat-panel-title"),t._uU(7," C\xfang t\u1ee9 th\u1eddi "),t.qZA(),t.TgZ(8,"mat-panel-description"),t._uU(9," Ch\u1ec9nh s\u1eeda th\xf4ng b\xe1o c\xfang t\u1ee9 th\u1eddi "),t.qZA()(),t.TgZ(10,"mat-selection-list",3,4),t.NdJ("ngModelChange",function(f){return i.pushNotificationsSettings.tuThoi=f})("selectionChange",function(){return i.selectionChange()}),t.YNc(12,E,5,4,"mat-list-option",5),t.qZA()()()()),2&n&&(t.xp6(4),t.Q6J("expanded",!0),t.xp6(6),t.Q6J("ngModel",i.pushNotificationsSettings.tuThoi),t.xp6(2),t.Q6J("ngForOf",i.tuthoiEvents))},dependencies:[p.sg,c.pp,c.ib,c.yz,c.yK,c.u4,h.Ub,h.vS,h.WW,h.sL,r.JJ,r.On]});const S=[{path:"",component:g}];class u{}u.\u0275fac=function(n){return new(n||u)},u.\u0275mod=t.oAB({type:u}),u.\u0275inj=t.cJS({imports:[d.Bz.forChild(S),d.Bz]});class l{}l.\u0275fac=function(n){return new(n||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[p.ez,u,c.To,h.ie,r.u5]})}}]);