"use strict";(self.webpackChunkpwa=self.webpackChunkpwa||[]).push([[820],{2820:(Z,v,s)=>{s.r(v),s.d(v,{NotificationsModule:()=>h});var d=s(6895),T=s(9299),t=s(4650),C=s(2729),A=s(5604),c=s(7084),r=s(6338),p=s(4006),m=s(9549),S=s(284);function D(u,o){if(1&u&&(t.TgZ(0,"mat-list-option",8)(1,"span",9),t._uU(2),t.qZA(),t.TgZ(3,"span",10),t._uU(4),t.qZA()()),2&u){const i=o.$implicit;t.Q6J("value",null==i?null:i.key),t.xp6(2),t.Oqu(null==i?null:i.name),t.xp6(2),t.AsE("",null==i?null:i.startTime," - ",null==i?null:i.endTime,"")}}class g{constructor(o,i,f){this.eventService=o,this.datePipe=i,this.commonService=f,this.eventList=[],this.tuthoiEvents=[],this.pushNotificationsSettings={tuThoi:[],tuThoiDuration:10},this.tuThoiUpdate=()=>{let a=JSON.parse(localStorage.getItem("pushNotification")||"[]");this.pushNotificationsSettings.tuThoiDuration||(this.pushNotificationsSettings.tuThoiDuration=10),this.eventList.find(n=>"cung-tu-thoi"===n.key)?.event?.filter(n=>"cung-tu-thoi"!==n.key)?.filter(n=>this.pushNotificationsSettings?.tuThoi?.includes(n?.key))?.forEach(n=>{const E=new Date,M=`Th\xf4ng b\xe1o ${n?.name}`;(()=>{const e=new Date(`${this.datePipe.transform(E,"yyyy-MM-dd")} ${n?.time[0].split("-")[1]?.slice(0,2)}:00:00`);Array.from({length:7},(J,y)=>{a||(a=[]);const N={body:`\u0110\xe3 \u0111\u1ebfn ${this.datePipe.transform(e,"HH:mm")}, l\xe0 gi\u1edd ${n?.name}`,data:{url:`${location.origin}/lich/su-kien/cung-thoi-ty`},icon:"assets/icons/windows11/Square150x150Logo.scale-400.png",image:"assets/icons/windows11/Wide310x150Logo.scale-400.png"};e.setDate(e.getDate()+(0==y?0:1)),a.push({key:`${n?.key}.${this.datePipe.transform(e,"yyyyMMddHHmmss")}`,title:M,payload:N,notificationAt:this.datePipe.transform(e,"yyyy-MM-dd HH:mm:ss")})})})(),(()=>{const e=new Date(`${this.datePipe.transform(E,"yyyy-MM-dd")} ${n?.time[0].split("-")[1]?.slice(0,2)}:00:00`);e.setMinutes(e.getMinutes()-(this.pushNotificationsSettings?.tuThoiDuration||10)),Array.from({length:7},(J,y)=>{a||(a=[]);const N={body:`H\xe3y chu\u1ea9n b\u1ecb ${n?.name} v\xe0o l\xfac ${this.datePipe.transform(e,"HH:mm")}`,data:{url:`${location.origin}/lich/su-kien/cung-thoi-ty`},icon:"assets/icons/windows11/Square150x150Logo.scale-400.png",image:"assets/icons/windows11/Wide310x150Logo.scale-400.png"};e.setDate(e.getDate()+(0==y?0:1)),a?.push({key:`${n?.key}.${this.datePipe.transform(e,"yyyyMMddHHmmss")}`,title:M,payload:N,notificationAt:this.datePipe.transform(e,"yyyy-MM-dd HH:mm:ss")})})})()}),localStorage.setItem("pushNotification",JSON.stringify("")),a?.length>0&&a?.forEach(n=>{n?.key?.includes("cung-thoi")?this.pushNotificationsSettings.tuThoi?.includes(n?.key?.split(".")[0])&&this.commonService.pushNotification(n?.key,n?.title,n?.payload,new Date(n?.notificationAt),!1):this.commonService.pushNotification(n?.key,n?.title,n?.payload,new Date(n?.notificationAt),!1)})}}ngOnInit(){this.getEvents()}getNotificationSettings(){JSON.parse(localStorage.getItem("pushNotification")||"[]"),this.pushNotificationsSettings=JSON.parse(localStorage.getItem("pushNotificationsSettings")||"{}"),this.tuThoiUpdate()}getEvents(){this.eventService.getEventList().subscribe(o=>{o&&(this.eventList=o.data,this.tuthoiEvents=this.eventList.find(i=>"cung-tu-thoi"===i.key)?.event?.filter(i=>"cung-tu-thoi"!==i.key),this.tuthoiEvents.forEach(i=>{i.startTime=`${i?.time[0].split("-")[1]?.slice(0,2)}:00`,i.endTime=`${i?.time[0].split("-")[1]?.slice(2,4)}:00`}),this.pushNotificationsSettings.tuThoi=this.tuthoiEvents.map(i=>({key:i?.key,name:i?.name,isActive:null})),this.getNotificationSettings())})}selectionChange(){localStorage.setItem("pushNotificationsSettings",JSON.stringify(this.pushNotificationsSettings)),this.tuThoiUpdate(),this.getNotificationSettings()}changeDuration(){this.selectionChange()}}g.\u0275fac=function(o){return new(o||g)(t.Y36(C.P),t.Y36(d.uU),t.Y36(A.v))},g.\u0275cmp=t.Xpm({type:g,selectors:[["app-notifications"]],decls:18,vars:4,consts:[[1,"container-fluid"],["multi",""],[3,"expanded"],["appearance","fill",1,"form-control"],["type","number","matInput","",3,"ngModel","ngModelChange","change"],[3,"ngModel","ngModelChange","selectionChange"],["tuThoi",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["matListItemTitle",""],["matListItemLine",""]],template:function(o,i){1&o&&(t.TgZ(0,"div",0)(1,"h1"),t._uU(2,"C\xe0i \u0111\u1eb7t th\xf4ng b\xe1o"),t.qZA(),t.TgZ(3,"mat-accordion",1)(4,"mat-expansion-panel",2)(5,"mat-expansion-panel-header")(6,"mat-panel-title"),t._uU(7," C\xfang t\u1ee9 th\u1eddi "),t.qZA(),t.TgZ(8,"mat-panel-description"),t._uU(9," Ch\u1ec9nh s\u1eeda th\xf4ng b\xe1o c\xfang t\u1ee9 th\u1eddi "),t.qZA()(),t.TgZ(10,"div",0)(11,"mat-form-field",3)(12,"mat-label"),t._uU(13,"B\xe1o tr\u01b0\u1edbc (ph\xfat)"),t.qZA(),t.TgZ(14,"input",4),t.NdJ("ngModelChange",function(a){return i.pushNotificationsSettings.tuThoiDuration=a})("change",function(){return i.changeDuration()}),t.qZA()()(),t.TgZ(15,"mat-selection-list",5,6),t.NdJ("ngModelChange",function(a){return i.pushNotificationsSettings.tuThoi=a})("selectionChange",function(){return i.selectionChange()}),t.YNc(17,D,5,4,"mat-list-option",7),t.qZA()()()()),2&o&&(t.xp6(4),t.Q6J("expanded",!0),t.xp6(10),t.Q6J("ngModel",i.pushNotificationsSettings.tuThoiDuration),t.xp6(1),t.Q6J("ngModel",i.pushNotificationsSettings.tuThoi),t.xp6(2),t.Q6J("ngForOf",i.tuthoiEvents))},dependencies:[d.sg,c.pp,c.ib,c.yz,c.yK,c.u4,r.Ub,r.vS,r.WW,r.sL,p.Fj,p.wV,p.JJ,p.On,m.KE,m.hX,S.Nt],styles:["@media only screen and (max-width: 600px){.form-control[_ngcontent-%COMP%]{width:100%}}"]});const $=[{path:"",component:g}];class l{}l.\u0275fac=function(o){return new(o||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[T.Bz.forChild($),T.Bz]});class h{}h.\u0275fac=function(o){return new(o||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({imports:[d.ez,l,c.To,r.ie,p.u5,m.lN,S.c]})}}]);