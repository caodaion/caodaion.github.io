<div class="wrapper-container book-content-container">
  <app-header class="header" [prevPage]="{
      navigate: {
        link: getBackLink()
      }
    }">
    <div class="book-header">
      <app-header-title>{{ contentName }}</app-header-title>
      <app-header-sub-title *ngIf="author">{{author}}</app-header-sub-title>
    </div>
  </app-header>
  <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>
  <div class="book-container-wrapper" *ngIf="!isShowTableContent">
    <mat-tab-group class="h-full" (selectedIndexChange)="selectedIndex = $event">
      <mat-tab [label]="'Nội dung'">
        <mat-drawer-container>
          <mat-drawer-content>
            <div class="flex flex-col overflow-hidden h-full">
              <div *ngIf="content" class="h-100 flex-1 overflow-auto bg-white" [ngClass]="{'ps-4': !isPhone}">
                <iframe [src]="
                'https://docs.google.com/document/d/e/' +
                  content +
                  '/pub?embedded=true' | safe
              " frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen class="w-full h-full"
                  #googleDocContent></iframe>
              </div>
            </div>
            <div class="p-4 mt-4" *ngIf="(books | searchBookByKeyWord: {selectedChips: selectedChips})?.length > 1">
              <div class="text-2xl">Bài viết cùng loại:</div>
              <mat-chip-set aria-label="label selection">
                <mat-chip *ngFor="let chip of selectedChips">{{chip}}</mat-chip>
              </mat-chip-set>
              <div class="flex flex-wrap my-4">
                <div class="p-2 w-full" [ngClass]="{'!w-1/4': cols === 4}"
                  *ngFor="let item of books | searchBookByKeyWord: {selectedChips: selectedChips}">
                  <mat-card>
                    <mat-card-header>
                      <mat-icon mat-card-avatar *ngIf="!item?.finished" [ngStyle]="{fontSize: '40px', height: '40px'}"
                        matTooltip="Đang viết" class="text-[#4758b8]">history_edu</mat-icon>
                      <mat-icon mat-card-avatar *ngIf="item?.finished" [ngStyle]="{fontSize: '40px', height: '40px'}"
                        matTooltip="Hoàn thành" class="text-[#01855d]">check_circle</mat-icon>
                      <mat-card-title (click)="onItemFocus(item)"
                        class="hover:underline cursor-pointer">{{item?.name}}</mat-card-title>
                      <mat-card-subtitle class="hover:underline cursor-pointer">{{item?.author}}</mat-card-subtitle>
                    </mat-card-header>
                    <img mat-card-image *ngIf="item?.cover" [src]="item?.cover" [alt]="item?.name"
                      (click)="onItemFocus(item)" class="object-cover h-40 w-full cursor-pointer mt-3" />
                    <img mat-card-image *ngIf="!item?.cover" (click)="onItemFocus(item)"
                      src="/assets/icons/assets/book-bookmark-minimalistic-svgrepo-com.svg"
                      class="object-contain h-40 w-full cursor-pointer mt-3" [alt]="item?.name" />
                    <mat-card-content>
                      <div class="my-3">{{item?.description}}</div>
                      <mat-chip-set aria-label="label selection">
                        <mat-chip *ngFor="let chip of item?.labels">{{chip}}</mat-chip>
                      </mat-chip-set>
                    </mat-card-content>
                    <mat-card-actions>
                      <button mat-button (click)="onItemFocus(item)"> <mat-icon>visibility</mat-icon> ĐỌC
                        SÁCH</button>
                    </mat-card-actions>
                  </mat-card>
                </div>
              </div>
            </div>
          </mat-drawer-content>
          <mat-drawer [mode]="'side'" [position]="'end'" #libradianDrawer>
            <ng-container *ngFor="let item of tableContent">
              <a [href]="'thu-vien/' + key + '#' + item?.key" class="block p-3" matRipple
                (click)="isPhone ? libradianDrawer.toggle() : ''">
                <span class="font-black" *ngIf="item?.tagName == 'H1'">
                  {{ item.description }}
                </span>
                <span class="ps-1" *ngIf="item?.tagName == 'H2'">
                  {{ item.description }}
                </span>
                <span class="ps-2" *ngIf="item?.tagName == 'H3'">
                  {{ item.description }}
                </span>
                <span class="ps-3" *ngIf="item?.tagName == 'H4'">
                  {{ item.description }}
                </span>
                <span class="ps-4" *ngIf="item?.tagName == 'H5'">
                  {{ item.description }}
                </span>
                <span class="ps-5" *ngIf="item?.tagName == 'H6'">
                  {{ item.description }}
                </span>
                <span class="ps-6" *ngIf="!item?.tagName">{{
                  item.description
                  }}</span>
              </a>
              <mat-divider></mat-divider>
            </ng-container>
          </mat-drawer>
        </mat-drawer-container>
      </mat-tab>
      <mat-tab [label]="'Tài liệu gốc'" *ngIf="origin">
        <iframe *ngIf="selectedIndex === 1" [src]="
            'https://drive.google.com/file/d/' + origin + '/preview' | safe
          " class="w-full h-full" allow="autoplay"></iframe>
      </mat-tab>
    </mat-tab-group>
  </div>
  <app-bottom-navigator *ngIf="isNavigation" [prev]="{
      text: navigate?.prev?.text,
      navigate: { link: navigate?.prev?.link }
    }" [next]="{
      text: navigate?.next?.text,
      navigate: { link: navigate?.next?.link }
    }"></app-bottom-navigator>
</div>