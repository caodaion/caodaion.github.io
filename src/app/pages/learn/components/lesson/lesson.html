<mat-tab-group (selectedTabChange)="onTabChange($event)">
    <mat-tab label="B√†i ƒë·ªçc">
        <div class="lesson-info-section p-3 select-text">
            <div [innerHTML]="lessonPost?.content"></div>
        </div>
    </mat-tab>
    <mat-tab label="L·∫≠t th·∫ª" *ngIf="flashcards.length > 0">
        <div *ngIf="flashcards.length > 0" class="flashcard-screen">
            <div class="hidden md:block flashcard-hint">
                <span>Nh·∫•n ‚ÄúSpace‚Äù ƒë·ªÉ l·∫≠t th·∫ª, ‚Äú‚Üê / ‚Üí‚Äù ƒë·ªÉ chuy·ªÉn th·∫ª</span>
            </div>
            <div class="flashcard-stack vertical-stack card-nav-absolute">
                <div class="nav-btn nav-btn-left-abs" (click)="showPrevCard()">
                    <button mat-icon-button [disabled]="currentCardIndex === 0">
                        <app-icon name="chevron_left"></app-icon>
                    </button>
                </div>
                <div class="flashcard minimalist-card horizontal-flip" (click)="toggleFlip(currentCardIndex)"
                    [class.flipped]="flipped[currentCardIndex]" [class.no-anim]="noAnim">
                    <div class="flashcard-face flashcard-question horizontal-face question-bg">
                        <div class="flashcard-content">{{ flashcards[currentCardIndex][0] }}</div>
                        <div class="see-answer">Xem ƒë√°p √°n</div>
                    </div>
                    <div class="flashcard-face flashcard-answer horizontal-face answer-bg">
                        <div class="flashcard-content">{{ flashcards[currentCardIndex][1] }}</div>
                        <div class="see-answer">Xem c√¢u h·ªèi</div>
                    </div>
                </div>
                <div class="nav-btn nav-btn-right-abs" (click)="showNextCard()">
                    <button mat-icon-button [disabled]="currentCardIndex === flashcards.length - 1">
                        <app-icon name="chevron_right"></app-icon>
                    </button>
                </div>
            </div>
            <div class="flashcard-progress">
                <div class="progress-bar">
                    <div class="progress-bar-inner"
                        [style.width]="((currentCardIndex + 1) / flashcards.length * 100) + '%'">
                    </div>
                </div>
                <span class="progress-count">{{ currentCardIndex + 1 }} / {{ flashcards.length }} th·∫ª</span>
            </div>
        </div>
    </mat-tab>
    <mat-tab label="Tr·∫Øc nghi·ªám" *ngIf="quizzes.length > 0">
        <div class="quiz-section p-3 pb-0 flex flex-col items-center gap-6 h-full">
            <ng-container *ngIf="!showResult">
                <div class="w-full max-w-xl mx-auto mb-6 sticky top-0 bg-white dark:bg-gray-900 pt-3"
                    style="z-index: 10;">
                    <div class="quiz-progress-bar w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full transition-all duration-300"
                            [style.width]="((currentQuizIndex + 1) / quizzes.length * 100) + '%'"
                            [style.background]="'var(--hoc-app-background)'">
                        </div>
                    </div>
                    <div class="flex justify-between text-sm mt-1">
                        <span>C√¢u {{ currentQuizIndex + 1 }} / {{ quizzes.length }}</span>
                        <span>{{ ((currentQuizIndex + 1) / quizzes.length * 100) | number:'1.0-0' }}%</span>
                    </div>
                </div>
            </ng-container>
            <ng-container *ngIf="!showResult">
                <div *ngIf="quizzes.length > 0"
                    class="quiz-question rounded-lg bg-white dark:bg-gray-900 p-4 md:p-8 w-full max-w-xl flex flex-col items-center justify-around"
                    [ngStyle]="{
                        flex: '1'
                    }">
                    <div class="w-full flex flex-col items-center mb-6">
                        <span class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2 text-center">C√¢u {{
                            currentQuizIndex +
                            1 }}: {{ quizzes[currentQuizIndex].cau_hoi }}</span>
                    </div>
                    <div class="choices flex flex-wrap justify-center gap-3 mb-8">
                        <button mat-stroked-button *ngFor="let choice of quizzes[currentQuizIndex].lua_chon"
                            class="min-w-[100px] py-2 px-4 rounded text-base font-medium !h-auto min-h-[36px]"
                            [ngClass]="{
                                '!bg-blue-500 !text-white !border-blue-500': quizzes[currentQuizIndex].selected == choice
                            }" (click)="selectChoice(currentQuizIndex, choice)">
                            {{ choice }}
                        </button>
                    </div>
                </div>
                <div class="w-full flex justify-between mt-8 border-t py-4 sticky bottom-0 bg-white dark:bg-gray-900">
                    <button mat-stroked-button color="accent" (click)="goToNextQuiz(true)"
                        *ngIf="!quizzes[currentQuizIndex]?.selected">B·ªè qua</button>
                    <div *ngIf="quizzes[currentQuizIndex]?.selected"></div>
                    <button mat-flat-button color="primary" [disabled]="!quizzes[currentQuizIndex]?.selected"
                        (click)="goToNextQuiz()">
                        {{ currentQuizIndex < quizzes.length - 1 ? 'C√¢u ti·∫øp theo' : 'Ki·ªÉm tra' }} </button>
                </div>
            </ng-container>
            <ng-container *ngIf="showResult">
                <div
                    class="quiz-result-page w-full max-w-2xl bg-gradient-to-br from-blue-100 via-white to-green-100 dark:from-gray-900 dark:via-gray-800 dark:to-green-900 rounded-xl shadow-2xl p-4 md:p-8 border border-gray-200 dark:border-gray-700 flex flex-col items-center">
                    <div class="flex flex-col items-center w-full mb-8">
                        <div class="text-4xl font-extrabold text-green-700 dark:text-green-400 mb-2 text-center">
                            üéâ
                        </div>
                        <div class="text-4xl font-extrabold text-green-700 dark:text-green-400 mb-2 text-center">
                            Ho√†n th√†nh b√†i h·ªçc!
                        </div>
                        <div class="text-lg text-center mb-2 text-gray-700 dark:text-gray-200">Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n
                            th√†nh b√†i h·ªçc v·ªõi ch·ªß ƒë·ªÅ "{{ lessonPost?.title }}"</div>
                        <div
                            class="score-card flex flex-col items-center justify-center bg-white dark:bg-gray-900 rounded-lg shadow-lg px-8 py-6 mb-4">
                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-300 mb-2">ƒêi·ªÉm s·ªë c·ªßa b·∫°n</div>
                            <div class="text-5xl font-extrabold text-green-700 dark:text-green-400 mb-2">{{ correctCount
                                }} / {{ quizzes.length }}</div>
                            <div class="text-base text-gray-500 dark:text-gray-400">{{ ((correctCount / quizzes.length)
                                * 100) | number:'1.0-0' }}%</div>
                        </div>
                        <button mat-raised-button color="primary"
                            class="mt-2 px-6 py-2 text-lg font-semibold rounded-full shadow-lg !h-auto !min-h-[36px]"
                            (click)="shareResult(shareResultDialog)">
                            <app-icon name="share"></app-icon> T·∫£i ·∫£nh chia s·∫ª k·∫øt qu·∫£
                        </button>
                    </div>
                    <div class="quiz-answers-list flex flex-col gap-4 w-full">
                        <div *ngFor="let quiz of quizzes; let i = index"
                            class="answer-item p-4 rounded border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 flex flex-col items-center justify-between">
                            <div class="font-semibold mb-2 md:mb-0">C√¢u {{ i + 1 }}: {{ quiz.cau_hoi }}</div>
                            <div class="flex flex-wrap gap-2 items-center">
                                <span>ƒê√°p √°n c·ªßa b·∫°n: <b>{{ quiz.selected || 'Ch∆∞a ch·ªçn' }}</b></span>
                                <span *ngIf="quiz.selected === quiz.dap_an"
                                    class="text-green-600 flex items-center ml-2"><app-icon
                                        name="check_circle"></app-icon> ƒê√∫ng</span>
                                <span *ngIf="quiz.selected && quiz.selected !== quiz.dap_an"
                                    class="text-red-600 flex items-center ml-2"><app-icon name="cancel"></app-icon>
                                    Sai</span>
                                <span class="ml-2">| ƒê√°p √°n ƒë√∫ng: <b>{{ quiz.dap_an }}</b></span>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
    </mat-tab>
</mat-tab-group>
<ng-template #shareResultDialog>
    <mat-dialog-content>
        <div class="text-center">B·∫°n c≈©ng c√≥ th·ªÉ thay ƒë·ªïi n·ªôi dung ·∫£nh chia s·∫ª v√† nh·∫≠p t√™n c·ªßa b·∫°n b√™n trong d·∫•u "[" "]"
        </div>
        <div #sharedResultContent contenteditable="true"
            class="quiz-result-share-card w-full max-w-xl bg-gradient-to-br from-blue-100 via-white to-green-100 dark:from-gray-900 dark:via-gray-800 dark:to-green-900 rounded-xl shadow-2xl p-2 sm:p-4 md:p-8 border border-gray-200 dark:border-gray-700 flex flex-col items-center"
            style="box-sizing: border-box; min-width: 0; word-break: break-word;">
            <div class="flex flex-col items-center w-full">
                <div class="font-extrabold text-green-700 dark:text-green-400 mb-2 text-center text-base md:text-xl lg:text-2xl xl:text-3xl">
                    Ch√∫c m·ª´ngüéâ
                </div>
                <div class="font-extrabold text-green-700 dark:text-green-400 mb-2 text-center text-xl md:text-3l lg:text-4xl xl:text-4xl">
                    [  ]
                </div>
                <div class="font-extrabold text-green-700 dark:text-green-400 mb-2 text-center text-base md:text-lg lg:text-xl xl:text-2xl">
                    ƒê√£ ho√†n th√†nh b√†i h·ªçc
                </div>
                <div class="font-extrabold text-green-700 dark:text-green-400 mb-2 text-center text-2xl md:text-4xl lg:text-5xl xl:text-5xl">
                    {{ lessonPost?.title }}
                </div>
                <div
                    class="score-card flex flex-col items-center justify-center bg-white dark:bg-gray-900 rounded-lg shadow-lg px-4 py-4 mb-4">
                    <div class="font-bold text-blue-600 dark:text-blue-300 mb-2 text-sm md:text-base lg:text-lg xl:text-xl">V·ªõi ƒëi·ªÉm s·ªë
                    </div>
                    <div class="font-extrabold text-green-700 dark:text-green-400 mb-2 text-lg md:text-2xl lg:text-3xl xl:text-4xl">{{
                        correctCount
                        }} / {{ quizzes.length }}</div>
                    <div class="text-gray-500 dark:text-gray-400 text-xs md:text-sm lg:text-base xl:text-lg">{{ ((correctCount /
                        quizzes.length)
                        * 100) | number:'1.0-0' }}%</div>
                </div>
            </div>

            <!-- App signature -->
            <div class="app-signature">
              <svg width="24px" height="24px" viewBox="0 0 1920 1920" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="1685.33" y="1280" width="213.333" height="725.332" transform="rotate(90 1685.33 1280)"
                  fill="#4285F4" />
                <path d="M601.607 853.332V1066.67L98.1416 1066.67L98.1416 853.332L601.607 853.332Z" fill="#FBBC05" />
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M1327.38 73.0755C1210.9 24.8311 1086.07 0 960.001 0L960.001 213.333C960.001 213.333 960.001 213.333 960.001 213.333C1372.37 213.333 1706.67 547.626 1706.67 959.998C1706.67 1372.37 1372.37 1706.66 960.001 1706.66C960.001 1706.66 960.001 1706.66 960 1706.66L960 1920C1086.07 1920 1210.9 1895.17 1327.38 1846.92C1443.85 1798.68 1549.68 1727.96 1638.82 1638.82C1727.97 1549.68 1798.68 1443.85 1846.92 1327.37C1895.17 1210.9 1920 1086.07 1920 959.999C1920 833.93 1895.17 709.096 1846.92 592.623C1798.68 476.151 1727.97 370.321 1638.82 281.177C1549.68 192.033 1443.85 121.32 1327.38 73.0755Z"
                  fill="#EA4335" />
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M2.4076e-05 959.997C2.29393e-05 1128.51 44.3579 1294.06 128.615 1440L313.368 1333.33C247.834 1219.82 213.334 1091.06 213.334 959.997C213.334 828.93 247.835 700.172 313.368 586.664L959.998 959.997L959.999 959.997L313.368 586.664L128.615 479.998C44.3579 625.936 2.52127e-05 791.482 2.4076e-05 959.997Z"
                  fill="#FBBC05" />
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M960.003 1493.33C854.519 1493.33 751.405 1462.05 663.699 1403.45C575.993 1344.84 507.634 1261.55 467.268 1164.1C426.901 1066.64 416.339 959.406 436.918 855.95C457.497 752.494 508.292 657.463 582.88 582.875C657.468 508.287 752.498 457.492 855.955 436.913C959.411 416.335 1066.65 426.897 1164.1 467.263C1261.55 507.63 1344.85 575.988 1403.45 663.695C1462.06 751.401 1493.33 854.515 1493.33 959.998L1280 959.998C1280 783.267 1136.73 639.998 960.003 639.998C783.272 639.998 640.004 783.267 640.004 959.998C640.004 1136.73 783.272 1280 960.003 1280V1493.33Z"
                  fill="#4285F4" />
                <rect x="853.335" y="959.998" width="213.333" height="426.666" fill="#4285F4" />
                <circle cx="960.002" cy="959.999" r="106.666" fill="#FBBC05" />
                <circle cx="960.004" cy="1813.33" r="106.666" fill="#FBBC05" />
                <circle cx="960.002" cy="1386.66" r="106.666" fill="#4285F4" />
                <circle cx="1386.67" cy="959.999" r="106.666" fill="#EA4335" />
                <circle cx="960.002" cy="106.666" r="106.666" fill="#4285F4" />
                <circle cx="220.993" cy="1386.66" r="106.666" transform="rotate(60 220.993 1386.66)" fill="#EA4335" />
                <circle cx="220.433" cy="533.014" r="106.666" transform="rotate(30 220.433 533.014)" fill="#4285F4" />
              </svg>
              <span>www.caodaion.com</span>
            </div>
        </div>

        <!-- Image preview -->
        <div class="preview-container" *ngIf="imagePreviewUrl">
            <h3 class="px-4">Xem tr∆∞·ªõc ·∫£nh</h3>
            <div class="preview-image">
                <img #previewImage [src]="imagePreviewUrl" alt="Event preview" />
            </div>
        </div>

        <div class="loading-indicator" *ngIf="isGenerating">
            <p>ƒêang t·∫°o ·∫£nh...</p>
        </div>
    </mat-dialog-content>
    <mat-dialog-actions [align]="'end'" class="dialog-actions">
        <div class="dialog-actions">
            <button class="matButton" mat-button color="primary" (click)="generateImage()" [disabled]="isGenerating"
                matTooltip="T·∫£i xu·ªëng ·∫£nh" aria-label="Download image">
                <app-icon name="draw"></app-icon>
                <span>T·∫°o ·∫£nh</span>
            </button>
            <button class="matButton" mat-button color="primary" (click)="generateImage(true)" [disabled]="isGenerating"
                matTooltip="T·∫£i xu·ªëng ·∫£nh" aria-label="Download image">
                <app-icon name="download"></app-icon>
                <span>T·∫£i ·∫£nh</span>
            </button>
            <button class="matButton" mat-button color="warn" (click)="closeDialog()" matTooltip="ƒê√≥ng"
                aria-label="Close">
                <app-icon name="close"></app-icon>
                <span>ƒê√≥ng</span>
            </button>
        </div>
    </mat-dialog-actions>
</ng-template>