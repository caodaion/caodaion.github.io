<div class="py-4">
    <mat-form-field class="w-full" appearance="outline">
        <mat-label>Xem theo tên {{filteringName?.length}}/{{congPhuFilterSetting?.length}}</mat-label>
        <mat-select [(ngModel)]="filteringName" [multiple]="true" (ngModelChange)="initChart()">
            <mat-option *ngFor="let item of congPhuFilterSetting" [value]="item?.na + '-' + item?.by + '-' + item?.tt">
                {{item?.na}} - {{item?.by}} - {{item?.tt}}
            </mat-option>
        </mat-select>
    </mat-form-field>
    <div class="bg-[#fbbc05] px-3 py-6 rounded mb-4">
        <div class="flex items-center py-4">
            <div class="w-full flex flex-col items-center justify-center text-2xl font-bold" *ngIf="user?.consecutive">
                <div class="text-6xl py-2 px-4 rounded-full">{{user?.consecutive | number: '2.0-0'}}</div>
                <div class="text-center">Ngày cúng tứ thời liên tục!</div>
                <div class="text-center text-xl" *ngIf="user?.consecutiveFrom?.lunar">Từ ngày
                    {{user?.consecutiveFrom?.lunar?.lunarDay}}/{{user?.consecutiveFrom?.lunar?.lunarMonth}}/{{user?.consecutiveFrom?.lunar?.lunarYearName}}
                </div>
                <div class="text-center text-xl" *ngIf="user?.consecutiveFrom?.lunar">({{user?.consecutiveFrom?.solar | date: 'dd/MM/YYYY'}})</div>
            </div>
            <div class="w-full flex flex-col items-center justify-center">
                <span class="material-symbols-outlined text-[140px]">
                    {{icon}}
                </span>
                <button mat-icon-button (click)="refreshData()" [matTooltip]="'Làm mới dữ liệu'">
                    <span class="material-symbols-outlined">
                        sync
                    </span>
                </button>
            </div>
            <div class="text-3xl text-center w-full flex items-center justify-center" *ngIf="!user?.consecutive">
                Hãy liên tục thực hành cúng tứ thời mỗi ngày bạn nhé!
            </div>
        </div>
        <mat-divider></mat-divider>
        <div class="mt-4" *ngIf="nextTarget > 0">
            <div class="text-center text-2xl font-bold">Mục tiêu tiếp theo: {{user?.consecutive | number:
                '2.0-0'}}/{{nextTarget | number: '2.0-0'}}</div>
            <div class="flex justify-evenly items-center relative mt-4">
                <div class="h-2 bg-black w-full absolute top-1/2 left-0"></div>
                <div *ngFor="let target of targetRange; let targetIndex = index" class="relative bg-[#fbbc05]"
                    [ngClass]="{
                    'animate-bounce': target >= nextTarget,
                }" [ngStyle]="{
                    'animation-delay': targetIndex * 150 + 'ms'
                }">
                    <span class="material-symbols-outlined text-6xl relative">
                        calendar_today
                        <div *ngIf="target < nextTarget"
                            class="absolute top-1/2 left-1/2 translate-x-[-50%] translate-y-[-45%] bg-black h-[40px] w-[40px] rounded-sm">
                        </div>
                    </span>
                    <div class="text-xs absolute top-1/2 left-1/2 translate-x-[-50%] translate-y-[-20%]" [ngClass]="{
                        'text-[#fbbc05]': target < nextTarget
                    }">
                        {{target | number: '2.0-0'}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <mat-form-field class="w-full mt-6" appearance="outline">
        <mat-label>Thống kê vào thời gian</mat-label>
        <mat-select [(ngModel)]="selectedTimeRange" (ngModelChange)="initChart()">
            <mat-optgroup *ngFor="let year of timeFilterOptions" [label]="'Năm ' + year?.key">
                <mat-option *ngFor="let month of year?.month" [value]="year.key + '-' + (month | number: '2.0-0')">
                    Tháng {{month}} năm {{year?.key}}
                </mat-option>
            </mat-optgroup>
        </mat-select>
    </mat-form-field>
    <div class="py-4">
        <canvas id="congPhuReport"></canvas>
    </div>
    <div class="py-4">
        <div class="flex items-center justify-between">
            <div class="text-xl text-center">Xem chi tiết ngày {{viewDetailsData?.date | date: 'dd/MM/YYYY'}}</div>
        </div>
        <table class="w-full" *ngIf="viewDetailsData?.data?.length > 0">
            <thead>
                <tr class="border-b py-3">
                    <th class="py-3">Ghi lại lúc</th>
                    <th class="py-3">Đánh giá tập trung</th>
                    <th class="py-3">Chất lượng</th>
                    <th class="py-3">Ghi chú</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of viewDetailsData?.data" class="border-b">
                    <td class="py-3">{{item?.time}}</td>
                    <td class="py-3">{{getValuePoint('focus', item?.focus)}}</td>
                    <td class="py-3">{{getValuePoint('quality', item?.quality)}}</td>
                    <td class="py-3 whitespace-break-spaces" [innerHTML]="item?.note"></td>
                </tr>
            </tbody>
        </table>
        <div class="text-center text-xl" *ngIf="!viewDetailsData?.data || viewDetailsData?.data?.length === 0">
            Bạn không không thực hành hoặc chưa ghi lại ngày {{viewDetailsData?.date | date: 'dd/MM/YYYY'}}
        </div>
    </div>
</div>