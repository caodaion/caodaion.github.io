<div class="wrapper-container lunar-calendar-container">
  <mat-toolbar class="lunar-calendar-toolbar justify-content-between">
    <div class="d-flex align-items-center w-100">
      <div
        class="d-flex align-items-center justify-content-between"
        [ngClass]="viewPortMode === 'mobile' ? 'w-100' : ''"
      >
        <div *ngIf="viewPortMode === 'mobile'">
          <mat-select
            [(ngModel)]="monthSelectValue"
            (selectionChange)="
              onChangeSelectedCalendar(calendarMode, monthSelectValue)
            "
          >
            <mat-option
              *ngFor="let item of commonDateTimeValue.month"
              [value]="item?.key"
              >{{ item?.name }}</mat-option
            >
          </mat-select>
        </div>
        <button
          mat-stroked-button
          (click)="onChangeSelectedCalendar('current')"
          [matTooltip]="
            currentDate.solar.getDate() +
            ' tháng ' +
            currentDate.solar.getMonth() +
            ' năm ' +
            currentDate.solar.getFullYear()
          "
        >
          Hôm nay
        </button>
      </div>
      <button
        *ngIf="viewPortMode === 'desktop'"
        mat-icon-button
        (click)="onChangeSelectedCalendar('before')"
        [matTooltip]="calendarMode === 'day' ? 'ngày trước' : 'tháng trước'"
      >
        <mat-icon>navigate_before</mat-icon>
      </button>
      <button
        *ngIf="viewPortMode === 'desktop'"
        mat-icon-button
        (click)="onChangeSelectedCalendar('next')"
        [matTooltip]="calendarMode === 'day' ? 'ngày sau' : 'tháng sau'"
      >
        <mat-icon>navigate_next</mat-icon>
      </button>
      <span class="selected-date" *ngIf="viewPortMode === 'desktop'">
        {{
          calendarMode === "day" || calendarMode === "month"
            ? "tháng " + (selectedDate.solar?.getMonth() + 1)
            : ""
        }}
        {{ selectedDate.solar.getFullYear() }} ({{ selectedDate.lunar.convertSolar2Lunar.lunarMonthName }}/{{ selectedDate.lunar.convertSolar2Lunar.lunarYearName }})</span
      >
    </div>
    <div class="flex flex-wrap w-full justify-end">
      <div
        (click)="filter.event = !filter.event"
        class="cursor-pointer bg-[#34a853] border border-[#34a853] text-[#34a853] rounded px-3 transition"
        [ngClass]="{
          'bg-transparent': !filter.event,
          'text-white': filter.event
        }"
        [matTooltip]="'Hiển thị sự kiện'"
      >
        SK
      </div>
      <div
        (click)="filter.six = !filter.six"
        class="cursor-pointer bg-[#34a853] border border-[#34a853] text-[#34a853] rounded px-3 transition"
        [ngClass]="{
          'bg-transparent': !filter.six,
          'text-white': filter.six
        }"
        [matTooltip]="'Hiển thị lục trai'"
      >
        6
      </div>
      <div
        (click)="filter.ten = !filter.ten"
        class="cursor-pointer bg-[#34a853] border border-[#34a853] text-[#34a853] rounded px-3 transition"
        [ngClass]="{
          'bg-transparent': !filter.ten,
          'text-white': filter.ten
        }"
        [matTooltip]="'Hiển thị thập trai'"
      >
        10
      </div>
      <div
        (click)="filter.fifteen = !filter.fifteen"
        class="cursor-pointer bg-[#34a853] border border-[#34a853] text-[#34a853] rounded px-3 transition"
        [ngClass]="{
          'bg-transparent': !filter.fifteen,
          'text-white': filter.fifteen
        }"
        [matTooltip]="'Hiển thị thiên ngươn'"
      >
        15
      </div>
    </div>
  </mat-toolbar>
  <mat-divider></mat-divider>
  <div
    class="flex-1 h-100 wrapper-container selected-month-calendar"
    *ngIf="calendarMode === 'month'"
    (touchstart)="swipe($event, 'start')"
    (touchend)="swipe($event, 'end')"
  >
    <div class="days">
      <div class="day text-center">T2</div>
      <div class="day text-center">T3</div>
      <div class="day text-center">T4</div>
      <div class="day text-center">T5</div>
      <div class="day text-center">T6</div>
      <div class="day text-center">T7</div>
      <div class="day text-center">CN</div>
    </div>
    <div class="flex-1 dates h-100" (mousewheel)="onMouseWheel($event)">
      <mat-card
        class="date wrapper-container align-items-center"
        *ngFor="let date of selectedMonth"
        [ngStyle]="{
          height:
            selectedMonth.length % 6 === 0
              ? 'calc(100%/' + 6 + ')'
              : 'calc(100%/' + 5 + ')',
          maxHeight:
            selectedMonth.length % 6 === 0
              ? 'calc(100%/' + 6 + ')'
              : 'calc(100%/' + 5 + ')'
        }"
      >
        <div class="w-full flex justify-between">
          <button
            mat-flat-button
            class="!px-4"
            [ngClass]="getCurrentDate(date) ? 'current-date' : ''"
            (click)="onChangeCalendarMode('day', date)"
          >
            <div class="solar-date">{{ date?.solar?.getDate() }}</div>
            <div class="lunar-date">
              <span
                *ngIf="!!date?.lunar?.convertSolar2Lunar?.lunarLeap"
                [matTooltip]="
                  'Nhuận tháng ' + date?.lunar?.convertSolar2Lunar?.lunarMonth
                "
                >NH</span
              >
              {{ date?.lunar?.convertSolar2Lunar?.lunarDay }}/{{
                date?.lunar?.convertSolar2Lunar?.lunarMonth
              }}
            </div>
          </button>
          <div class="w-full flex flex-col lg:flex-row">
            <div
              class="m-0 lg:m-1 text-xs w-full bg-[#34a853] text-white flex items-center justify-center rounded"
              *ngIf="date?.six && filter.six"
              [matTooltip]="'lục trai'"
            >
              6
            </div>
            <div
              class="m-0 lg:m-1 text-xs w-full bg-[#34a853] text-white flex items-center justify-center rounded"
              *ngIf="date?.ten && filter.ten"
              [matTooltip]="'thập trai'"
            >
              10
            </div>
            <div
              class="m-0 lg:m-1 text-xs w-full bg-[#34a853] text-white flex items-center justify-center rounded"
              *ngIf="date?.fifteen && filter.fifteen"
              [matTooltip]="'thiên ngươn'"
            >
              15
            </div>
          </div>
        </div>
        <div class="flex-1 date-event w-100">
          <mat-list *ngIf="filter.event">
            <mat-list-item
              class="date-event-item"
              matRipple
              *ngFor="let event of date.event"
              [ngClass]="
                event?.event?.date === 'yearly-monthly-daily'
                  ? 'yearly-monthly-daily'
                  : event?.event?.date !== 'yearly-monthly-daily' &&
                    event?.event?.date?.includes('yearly-monthly-')
                  ? 'yearly-monthly-special'
                  : event?.event?.date !== 'yearly-monthly-daily' &&
                    !event?.event?.date?.includes('yearly-monthly-') &&
                    event?.event?.date?.includes('yearly-')
                  ? 'yearly-special-special'
                  : ''
              "
              (click)="openEventSummaryDialog(date, event, eventSummayDialog)"
            >
              {{ event?.event?.name || event?.event?.eventName }}
            </mat-list-item>
          </mat-list>
        </div>
      </mat-card>
    </div>
  </div>
  <div
    class="flex-1 h-100 wrapper-container selected-date-calendar"
    *ngIf="calendarMode === 'day'"
    (touchstart)="swipe($event, 'start')"
    (touchend)="swipe($event, 'end')"
  >
    <div class="current-selected-date">
      <div class="date-wraper">
        <div class="flex items-center lg:justify-between">
          <div class="date text-center">
            <div class="date-solar">
              {{ selectedDate.solar.getDate() }}
            </div>
            <div class="date-lunar">
              {{
                selectedDate.lunar.convertSolar2Lunar.lunarDay
                  | number : "2.0-0"
              }}/{{
                selectedDate.lunar.convertSolar2Lunar.lunarMonth
                  | number : "2.0-0"
              }}
            </div>
          </div>
          <div class="w-full lg:w-auto">
            <div class="text-right m-2 mb-0">
              Ngày {{ selectedDate.lunar.convertSolar2Lunar.lunarDayName }}
            </div>
            <div class="text-right mx-2">
              Tháng {{ selectedDate.lunar.convertSolar2Lunar.lunarMonthName }}
            </div>
            <div class="text-right m-2 mt-0">
              Năm {{ selectedDate.lunar.convertSolar2Lunar.lunarYearName }}
            </div>
          </div>
        </div>
      </div>
      <mat-divider></mat-divider>
    </div>
    <div class="date-hours" id="dateRange">
      <div
        class="munite d-flex"
        *ngFor="let timeRange of dateRange"
        [id]="
          'h' +
          (timeRange.hour | number : '2.0') +
          'm' +
          (timeRange.munite | number : '2.0')
        "
        [matTooltip]="
          viewPortMode === 'desktop'
            ? (timeRange.hour | number : '2.0') +
              ':' +
              (timeRange.munite | number : '2.0')
            : ''
        "
      >
        <div
          *ngIf="
            timeRange.munite === 0 ||
            (timeRange.hour !== 23 && timeRange.munite === 0)
          "
          class="start-time-hour"
        >
          {{ timeRange.hour < 10 ? "0" + timeRange.hour : timeRange.hour }}:{{
            timeRange.munite < 10 ? "0" + timeRange.munite : timeRange.munite
          }}
        </div>
        <mat-divider
          class="w-100"
          *ngIf="
            timeRange.munite === 0 ||
            (timeRange.hour !== 23 && timeRange.munite === 0)
          "
        ></mat-divider>
      </div>
      <div
        class="now-time"
        id="now"
        [ngStyle]="{
          top: getPosition(time.time | async)
            ? getPosition(time.time | async) + 'px'
            : ''
        }"
      >
        <div class="time-now text-[#eb4132]">
          {{ time.time | async | date : "HH:mm:ss" }}
        </div>
        <div class="clock"></div>
      </div>
      <div
        class="tu-thoi-zone"
        *ngFor="let zone of tuThoiZone"
        [ngStyle]="{ height: zone?.height + 'px', top: zone?.position + 'px' }"
      ></div>
      <div
        class="selected-date-events"
        *ngFor="let zone of dateEvents"
        [ngStyle]="{ top: getPosition(zone?.timeZone?.start) + 'px' }"
      >
        <div
          class="selected-date-event"
          *ngFor="let event of zone.event"
          [ngClass]="
            event?.event?.date === 'yearly-monthly-daily'
              ? 'yearly-monthly-daily'
              : event?.event?.date !== 'yearly-monthly-daily' &&
                event?.event?.date?.includes('yearly-monthly-')
              ? 'yearly-monthly-special'
              : event?.event?.date !== 'yearly-monthly-daily' &&
                !event?.event?.date?.includes('yearly-monthly-') &&
                event?.event?.date?.includes('yearly-')
              ? 'yearly-special-special'
              : ''
          "
          (click)="
            openEventSummaryDialog(selectedDate, event, eventSummayDialog)
          "
        >
          {{ event?.event?.name || event?.event?.eventName }}
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #eventSummayDialog>
  <div class="event-summary-dialog">
    <h2 mat-dialog-title>{{ shownDate?.event?.event?.name }}</h2>
    <mat-dialog-content>
      <div class="d-flex details-item">
        <mat-icon>event</mat-icon>
        {{
          shownDate?.event?.event?.date === "yearly-monthly-daily"
            ? "Mỗi ngày"
            : shownDate?.event?.event?.date !== "yearly-monthly-daily" &&
              shownDate?.event?.event?.date?.includes("yearly-monthly-")
            ? "Ngày " +
              shownDate?.event?.event?.date.split("-")[2] +
              " mỗi tháng"
            : shownDate?.event?.event?.date !== "yearly-monthly-daily" &&
              !shownDate?.event?.event?.date?.includes("yearly-monthly-") &&
              shownDate?.event?.event?.date?.includes("yearly-")
            ? "Ngày " +
              shownDate?.event?.event?.date?.split("-")[2] +
              " tháng " +
              shownDate?.event?.event?.date?.split("-")[1] +
              " mỗi năm"
            : shownDate?.event?.event?.date !== "yearly-monthly-daily" &&
              !shownDate?.event?.event?.date?.includes("yearly-monthly-") &&
              shownDate?.event?.event?.date?.includes("yearly-")
            ? "Ngày " +
              shownDate?.event?.event?.date?.split("-")[2] +
              " tháng " +
              shownDate?.event?.event?.date?.split("-")[1] +
              " năm" +
              shownDate?.event?.event?.date?.split("-")[0]
            : shownDate?.event?.event?.date
        }}
      </div>
      <div
        class="d-flex details-item"
        *ngIf="shownDate?.event?.event?.time?.length > 0"
      >
        <mat-icon>schedule</mat-icon>
        <span *ngFor="let time of getTimes(shownDate?.event?.event?.time)">{{
          time?.name
        }}</span>
      </div>
      <div
        class="d-flex details-item"
        *ngIf="shownDate?.event?.event?.locationType?.length > 0"
      >
        <mat-icon>location_pin</mat-icon>
        <span
          *ngFor="
            let time of getLocationTypes(shownDate?.event?.event?.locationType)
          "
          >{{ time?.name }}</span
        >
      </div>
    </mat-dialog-content>
    <mat-dialog-actions>
      <button mat-button mat-dialog-close>Đóng</button>
      <button
        mat-flat-button
        [color]="'primary'"
        (click)="onGetKinhFromSummaryEvent()"
        [mat-dialog-close]="true"
      >
        Xem kinh
      </button>
      <button
        mat-button
        [color]="'primary'"
        (click)="syncToGoogleCalendar()"
        [mat-dialog-close]="true"
      >
        <mat-icon>cloud_sync</mat-icon>
        Đồng bộ lên Google Calendar
      </button>
    </mat-dialog-actions>
  </div>
</ng-template>
