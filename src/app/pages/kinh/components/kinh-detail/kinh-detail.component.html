<div class="kinh-detail-page">
  <!-- Enhanced Header -->
  <app-child-header *ngIf="kinhInfo$ | async as kinhInfo" [title]="kinhInfo.name">
    <div class="header-controls">
      <div class="font-controls" tourAnchor="kinh.fontSize">
        <label for="font-size-select" class="font-size-label">Cỡ chữ:</label>
        <mat-select id="font-size-select" class="font-size-select" [(ngModel)]="fontSize" panelClass="font-size-panel"
          (change)="onFontSizeChange($event)">
          <mat-option *ngFor="let size of fontSizeOptions" [value]="size">{{size}} px</mat-option>
        </mat-select>
        <button class="font-reset-btn" (click)="resetFontSize()" title="Đặt lại cỡ chữ mặc định">
          <span class="material-icons">
            <app-icon name="refresh"></app-icon>
          </span>
        </button>
      </div>

      <div class="action-controls">
        <button-share tourAnchor="kinh.share">
          <button class="action-btn share-btn" aria-label="Share">
            <span class="material-icons">
              <app-icon name="share"></app-icon>
            </span>
          </button>
        </button-share>
      </div>
    </div>
  </app-child-header>

  <!-- Main Content Container -->
  <div class="kinh-detail-container" tourAnchor="kinh.readArea">
    <mat-tab-group class="tab-group" [(selectedIndex)]="selectedTabIndex" (selectedIndexChange)="onTabChange($event)">
      <mat-tab label="Đọc kinh">
        <!-- Content Area -->
        <main class="content-section">
          <article class="kinh-content-card" *ngIf="kinhContent$ | async as content">
            <!-- Error State -->
            <div *ngIf="error" class="error-state">
              <span class="material-icons error-icon">
                <app-icon name="error_outline"></app-icon>
              </span>
              <h3>Không thể tải nội dung</h3>
              <p>{{ error }}</p>
              <button class="retry-btn" (click)="ngOnInit()">
                <span class="material-icons">
                  <app-icon name="refresh"></app-icon>
                </span>
                Thử lại
              </button>
            </div>

            <!-- Content -->
            <div *ngIf="!error" class="markdown-content" [style.font-size.px]="fontSize">
              <markdown [data]="content"></markdown>
            </div>
          </article>
        </main>
      </mat-tab>
      <mat-tab label="Thông tin">
        <ng-container *ngIf="selectedTabIndex === 1">
          <app-kinh-information [kinhKey]="kinhKey"></app-kinh-information>
        </ng-container>
      </mat-tab>
    </mat-tab-group>

    <!-- Navigation Section -->
    <nav class="navigation-section" *ngIf="prevKinh || nextKinh">
      <div class="nav-container" tourAnchor="kinh.navigationBar">
        <button class="nav-button prev-button" *ngIf="prevKinh" (click)="goToPreviousKinh()"
          [title]="'Bài trước: ' + prevKinh.name">
          <div class="nav-button-content">
            <span class="material-icons nav-icon">
              <app-icon name="chevron_left"></app-icon>
            </span>
            <div class="nav-text-group">
              <span class="nav-label">Bài trước</span>
              <span class="nav-title">{{ prevKinh.name }}</span>
            </div>
          </div>
        </button>

        <div class="nav-spacer"></div>

        <button class="nav-button next-button" *ngIf="nextKinh" (click)="goToNextKinh()"
          [title]="'Bài tiếp: ' + nextKinh.name">
          <div class="nav-button-content">
            <div class="nav-text-group">
              <span class="nav-label">Bài tiếp</span>
              <span class="nav-title">{{ nextKinh.name }}</span>
            </div>
            <span class="material-icons nav-icon">
              <app-icon name="chevron_right"></app-icon>
            </span>
          </div>
        </button>
      </div>
    </nav>
  </div>
  <!-- Floating Action Button (FAB) -->
  <button class="fab" cdkDrag cdkDragBoundary=".kinh-detail-page" (click)="openKinhList()" tourAnchor="kinh.listFab"
    [matTooltip]="'Danh sách kinh'">
    <span class="material-icons">
      <app-icon name="list"></app-icon>
    </span>
  </button>
</div>
<tour-step-template></tour-step-template>