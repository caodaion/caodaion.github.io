<div
  class="flex items-center justify-between border-b p-3 sticky top-0 z-20 bg-white"
>
  <div
    *ngIf="prev"
    class="w-full cursor-pointer flex items-center justify-start"
    [routerLink]="'/game/purify/' + prev.key"
  >
    <mat-icon>arrow_back_ios</mat-icon>
    {{ prev?.key }}. {{ prev?.name }}
  </div>
  <div class="w-[1px] h-6 bg-[#e5e7eb]"></div>
  <div
    *ngIf="next"
    class="w-full cursor-pointer flex items-center justify-end"
    [routerLink]="'/game/purify/' + next.key"
  >
    {{ next?.key }}. {{ next?.name }}
    <mat-icon>arrow_forward_ios</mat-icon>
  </div>
</div>
<div class="container-fluid">
  <div class="text-center pt-3">
    <p>{{ purify?.key }}</p>
    <h1>{{ purify?.name || "???" }}</h1>
  </div>
  <audio
    [src]="purify?.audio"
    [controls]="true"
    class="w-100"
    [autoplay]="true"
  ></audio>
  <div class="w-full flex flex-wrap py-8 relative">
    <div class="w-full lg:w-1/3">
      <app-purify-card [purify]="purify" (click)="saveCard()"></app-purify-card>
    </div>
    <div class="w-full lg:w-2/3 lg:sticky top-0">
      <div class="flex h-full flex-col">
        <div class="flex">
          <textarea
            *ngIf="contentEditable"
            class="variable-textarea w-1/2 h-full p-3"
            [(ngModel)]="purify.article"
            placeholder="Update the article content"
          ></textarea>
          <markdown
            *ngIf="purify.article"
            class="variable-binding w-full lg:w-1/2 p-3 text-justify bg-white"
            [data]="purify.article"
            [ngClass]="{ 'lg:w-full': !contentEditable }"
          ></markdown>
        </div>
        <div #videoFrame class="aspect-video"></div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid" *ngIf="contentEditable">
  <cp-qr-scanner (qrData)="scanComplete($event)"></cp-qr-scanner>
</div>

<ng-template #saveCardDialog>
  <app-purify-card [purify]="purify" [saveCard]="true"></app-purify-card>
</ng-template>

<ng-template #updatePurifyForKidDialog>
  <div mat-dialog-title>
    Cập nhật Purify <strong>{{ purify?.name }}</strong> cho<strong>
      {{ matchedPurifyKid?.kid?.name }}</strong
    >
  </div>
  <mat-dialog-content>
    <div class="p-3 w-full flex flex-wrap">
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Công Quả</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="matchedPurifyKid.purify.congQua"
          disabled
        />
      </mat-form-field>
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Cộng thêm Công Quả</mat-label>
        <input
          type="number"
          matInput
          [(ngModel)]="kidPurifyData.purify.congQua"
          (input)="updatePurifyOfKid()"
        />
      </mat-form-field>
    </div>
    <div class="p-3 w-full flex flex-wrap">
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Công Phu</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="matchedPurifyKid.purify.congPhu"
          disabled
        />
      </mat-form-field>
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Cộng thêm Công Phu</mat-label>
        <input
          type="number"
          matInput
          [(ngModel)]="kidPurifyData.purify.congPhu"
          (input)="updatePurifyOfKid()"
        />
      </mat-form-field>
    </div>
    <div class="p-3 w-full flex flex-wrap">
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Công Trình</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="matchedPurifyKid.purify.congTrinh"
          disabled
        />
      </mat-form-field>
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Cộng thêm Công Trình</mat-label>
        <input
          type="number"
          matInput
          [(ngModel)]="kidPurifyData.purify.congTrinh"
          (input)="updatePurifyOfKid()"
        />
      </mat-form-field>
    </div>
    <div class="p-3 w-full flex flex-wrap">
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Máu</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="matchedPurifyKid.purify.hp"
          disabled
        />
      </mat-form-field>
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Cộng thêm Máu</mat-label>
        <input
          type="number"
          matInput
          [(ngModel)]="kidPurifyData.purify.hp"
          (input)="updatePurifyOfKid()"
        />
      </mat-form-field>
    </div>
    <div class="p-3 w-full flex flex-wrap">
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Tấn công</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="matchedPurifyKid.purify.attack"
          disabled
        />
      </mat-form-field>
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Cộng thêm Tấn công</mat-label>
        <input
          type="number"
          matInput
          [(ngModel)]="kidPurifyData.purify.attack"
          (input)="updatePurifyOfKid()"
        />
      </mat-form-field>
    </div>
    <div class="p-3 w-full flex flex-wrap">
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Tốc độ</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="matchedPurifyKid.purify.speed"
          disabled
        />
      </mat-form-field>
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Cộng thêm Tốc độ</mat-label>
        <input
          type="number"
          matInput
          [(ngModel)]="kidPurifyData.purify.speed"
          (input)="updatePurifyOfKid()"
        />
      </mat-form-field>
    </div>
    <div class="p-3 w-full flex flex-wrap">
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Chống chịu</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="matchedPurifyKid.purify.def"
          disabled
        />
      </mat-form-field>
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Cộng thêm Chống chịu</mat-label>
        <input
          type="number"
          matInput
          [(ngModel)]="kidPurifyData.purify.def"
          (input)="updatePurifyOfKid()"
        />
      </mat-form-field>
    </div>
    <div class="p-3 w-full flex flex-wrap">
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Điểm tích lũy</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="matchedPurifyKid.point"
          disabled
        />
        <mat-icon
          class="cursor-pointer"
          matSuffix
          (click)="updatePoint(matchedPurifyKid.point)"
          >save</mat-icon
        >
      </mat-form-field>
      <mat-form-field class="w-full lg:w-1/2" [appearance]="'outline'">
        <mat-label>Cộng thêm Điểm tích lũy</mat-label>
        <input
          type="number"
          matInput
          [(ngModel)]="kidPurifyData.point"
          (input)="updatePurifyOfKid()"
        />
      </mat-form-field>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-flat-button [matDialogClose]="true">Hủy</button>
    <button
      mat-flat-button
      [matDialogClose]="true"
      [color]="'primary'"
      (click)="saveUpdatedPurify()"
    >
      Lưu
    </button>
  </mat-dialog-actions>
</ng-template>
