"use strict";(self.webpackChunkpwa=self.webpackChunkpwa||[]).push([[351],{1237:(ce,k,p)=>{p.d(k,{H:()=>ue});var s=p(4650),W=p(1005),B=p(659),q=p(6895),z=p(9549),$=p(4385),ee=p(3238),T=p(4006),Y=p(1572),te=p(9101),x=p(7392);const j=["action"];function K(S,I){if(1&S&&(s.TgZ(0,"mat-option",10),s._uU(1),s.qZA()),2&S){const m=I.$implicit;s.Q6J("value",m.deviceId),s.xp6(1),s.Oqu(m.label)}}function le(S,I){if(1&S){const m=s.EpF();s.TgZ(0,"mat-form-field",7)(1,"mat-label"),s._uU(2,"Ch\u1ecdn thi\u1ebft b\u1ecb qu\xe9t"),s.qZA(),s.TgZ(3,"mat-select",8),s.NdJ("ngModelChange",function(b){s.CHM(m),s.oxw();const M=s.MAs(4);return s.KtG(M.playDevice(b))}),s.YNc(4,K,2,2,"mat-option",9),s.qZA()()}if(2&S){s.oxw();const m=s.MAs(4);s.xp6(3),s.Q6J("ngModel",null),s.xp6(1),s.Q6J("ngForOf",m.devices.value)}}function de(S,I){1&S&&(s.TgZ(0,"h2",11),s._uU(1,' "\u1ee8ng d\u1ee5ng \u0111ang t\xecm thi\u1ebft b\u1ecb qu\xe9t c\u1ee7a b\u1ea1n\u{1f50d}. Xin \u0111\u1ee3i trong gi\xe2y l\xe1t nh\xe9\u{1f609}!" '),s._UZ(2,"mat-spinner"),s.qZA())}function G(S,I){if(1&S){const m=s.EpF();s.TgZ(0,"button",12),s.NdJ("click",function(){s.CHM(m);const b=s.oxw(),M=s.MAs(4);return M.isTorch=!M.isTorch,s.KtG(b.handle(M,"torcher"))}),s.TgZ(1,"mat-icon"),s._uU(2),s.qZA()()}if(2&S){s.oxw();const m=s.MAs(4);s.xp6(2),s.Oqu(m.isTorch?"flash_on":"flash_off")}}let ue=(()=>{class S{constructor(m){this.qrcode=m,this.qrData=new s.vpe,this.config={vibrate:400,deviceActive:0,constraints:{facingMode:"environment",audio:!1,video:{width:window.innerWidth}}},this.qrCodeResult=[],this.qrCodeResult2=[]}ngAfterViewInit(){this.action.stop(),this.action.isReady.pipe((0,W.g)(3e3)).subscribe(()=>{this.action.start()})}ngOnDestroy(){this.action.stop(),console.log("destroy")}onEvent(m){console.log(m),m[0]?.value&&(this.qrData.emit(m[0].value),this.action.pause().pipe((0,W.g)(3e3)).subscribe(()=>{this.action.play()}))}handle(m,P){m[P]().subscribe(console.log,alert)}}return S.\u0275fac=function(m){return new(m||S)(s.Y36(B.Lq))},S.\u0275cmp=s.Xpm({type:S,selectors:[["cp-qr-scanner"]],viewQuery:function(m,P){if(1&m&&s.Gf(j,5),2&m){let b;s.iGM(b=s.CRH())&&(P.action=b.first)}},outputs:{qrData:"qrData"},decls:7,vars:4,consts:[["class","w-100",4,"ngIf"],["class","d-flex flex-column align-items-center text-center",4,"ngIf"],[1,"scanner-wrapper"],[3,"config","event"],["action","scanner"],[1,"feature-button"],["mat-icon-button","","class","flash-button",3,"click",4,"ngIf"],[1,"w-100"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"d-flex","flex-column","align-items-center","text-center"],["mat-icon-button","",1,"flash-button",3,"click"]],template:function(m,P){if(1&m&&(s.YNc(0,le,5,2,"mat-form-field",0),s.YNc(1,de,3,0,"h2",1),s.TgZ(2,"div",2)(3,"ngx-scanner-qrcode",3,4),s.NdJ("event",function(M){return P.onEvent(M)}),s.qZA(),s.TgZ(5,"div",5),s.YNc(6,G,3,1,"button",6),s.qZA()()),2&m){const b=s.MAs(4);s.Q6J("ngIf",b.devices.value.length>0),s.xp6(1),s.Q6J("ngIf",0==b.devices.value.length),s.xp6(2),s.Q6J("config",P.config),s.xp6(3),s.Q6J("ngIf",b.devices.value.length>0)}},dependencies:[q.sg,q.O5,B.d$,z.KE,z.hX,$.gD,ee.ey,T.JJ,T.On,Y.Ou,te.RK,x.Hw],styles:[".scanner-wrapper[_ngcontent-%COMP%]{position:relative}.scanner-wrapper[_ngcontent-%COMP%]   .feature-button[_ngcontent-%COMP%]{position:absolute;bottom:20%;left:50%;transform:translate(-50%);width:100%;display:flex;justify-content:space-around}.scanner-wrapper[_ngcontent-%COMP%]   .feature-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#fff;background:rgba(0,0,0,.1215686275)}"]}),S})()},9370:(ce,k,p)=>{p.d(k,{s:()=>te});var s=p(6895),W=p(659),B=p(9549),q=p(4385),z=p(4006),$=p(1572),ee=p(9101),T=p(7392),Y=p(4650);let te=(()=>{class x{}return x.\u0275fac=function(K){return new(K||x)},x.\u0275mod=Y.oAB({type:x}),x.\u0275inj=Y.cJS({imports:[s.ez,W.Mk,B.lN,q.LD,z.u5,$.Cq,ee.ot,T.Ps]}),x})()},659:(ce,k,p)=>{function T(r,n,e,t){return new(e||(e=Promise))(function(i,a){function c(g){try{l(t.next(g))}catch(C){a(C)}}function u(g){try{l(t.throw(g))}catch(C){a(C)}}function l(g){g.done?i(g.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(g.value).then(c,u)}l((t=t.apply(r,n||[])).next())})}p.d(k,{d$:()=>Ie,Mk:()=>Ne,Lq:()=>Q});var Re=p(7579);class O extends Re.x{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(n){const{hasError:e,_hasValue:t,_value:o,thrownError:i,isStopped:a,_isComplete:c}=this;e?n.error(i):(a||c)&&(t&&n.next(o),n.complete())}next(n){this.isStopped||(this._value=n,this._hasValue=!0)}complete(){const{_hasValue:n,_value:e,_isComplete:t}=this;t||(this._isComplete=!0,n&&super.next(e),super.complete())}}var he=p(1135),E=p(4650);const ye=["video"],Ae=["canvas"],we=["resultsPanel"],_e={audio:!1,video:!0},N={src:"",fps:30,vibrate:300,decode:"utf-8",isBeep:!0,deviceActive:0,constraints:_e},f=(r,n,e=null)=>{e?r.error(e):r.next(n),r.complete()},ne=(r=!1)=>{if(!1===r)return;const n=new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"+Array(300).join("101"));n.oncanplaythrough=()=>{const e=n.play();e&&e.catch(t=>{})}},A=(r,n)=>{const e=n.split(".");for(let t=0;t<e.length;t++){let o=e[t];if(!r.hasOwnProperty(o))return!1;r=r[o]}return!0},fe=(r,n,e)=>{let t,o,i=n.width,a=n.height,c=i/a,u=parseInt(getComputedStyle(n).width),l=parseInt(getComputedStyle(n).height),g=u/l;e.innerHTML="",c>g?(t=u/i,o=u/c/a):(o=l/a,t=l*c/i);for(let C=0;C<r.length;C++){const _=r[C];let h=document.createElement("canvas"),R=h.getContext("2d",{willReadFrequently:!0}),y={},H=[],oe=[];const V=_.points;for(let w=0;w<V.length;w++){const Ee=A(V,`${w}.x`)?V[w].x:0,Se=A(V,`${w}.y`)?V[w].y:0;y[`x${w+1}`]=Ee,y[`y${w+1}`]=Se,H.push(Ee),oe.push(Se)}let ie=Math.max(...H),F=Math.min(...H),ae=Math.max(...oe),L=Math.min(...oe);h.setAttribute("class","qrcode-polygon"),c>g?(h.style.top=L*o+.5*(l-u/c)+"px",h.style.left=F*t+"px",h.width=(ie-F)*t,h.height=(ae-L)*t):(h.style.top=L*o+"px",h.style.left=F*t+.5*(u-l*c)+"px",h.width=(ie-F)*o,h.height=(ae-L)*o),R.lineWidth=1,R.strokeStyle="green",R.fillStyle="#55f02880";const se=[];for(let w=0;w<H.length;w++)se.push((y[`x${w+1}`]-F)*o),se.push((y[`y${w+1}`]-L)*t);const X=se.slice(0);for(R.beginPath(),R.moveTo(X.shift(),X.shift());X.length;)R.lineTo(X.shift(),X.shift());R.closePath(),R.fill(),R.stroke();const Z=document.createElement("div");Z.setAttribute("class","qrcode-tooltip-temp"),Z.innerText=_.value;const Me=`<?xml version="1.0" encoding="utf-8"?><svg version="1.1" class="qrcode-tooltip-clipboard" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${15*t}" height="${15*t}" x="0px" y="0px" viewBox="0 0 115.77 122.88" xml:space="preserve"><g><path d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path></g></svg> `,Fe=(new DOMParser).parseFromString(Me,"application/xml"),ge=Z.ownerDocument.importNode(Fe.documentElement,!0);Z.appendChild(ge),ge.addEventListener("click",()=>window.navigator.clipboard.writeText(_.value));const U=document.createElement("div");U.setAttribute("class","qrcode-tooltip"),U.appendChild(Z),o=l/a,t=l*c/i,U.style.fontSize=15*t+"px",U.style.top=L*o+"px",U.style.left=F*t+.5*(u-l*c)+"px",U.style.width=(ie-F)*o+"px",U.style.height=(ae-L)*o+"px";const J=document.createElement("span");J.innerText=_.value,J.style.fontSize=13*t+"px",J.style.top=L*o+-20*o+"px",J.style.left=F*t+.5*(u-l*c)+"px",e&&(e.appendChild(U),e.appendChild(J),e.appendChild(h))}},pe=(r,n)=>new Promise((e,t)=>r.toBlob(o=>e(o),n)),me=(r=[],n,e=new O)=>(Promise.all(Object.assign([],r).map(t=>((r,n)=>{let e=A(n,"decode")?n.decode:N.decode;return new Promise((t,o)=>{const i=new FileReader;i.onload=()=>{const a={name:r.name,file:r,url:URL.createObjectURL(r)},c=new Image;c.setAttribute("crossOrigin","anonymous"),c.onload=()=>T(void 0,void 0,void 0,function*(){const u=document.createElement("canvas");u.width=c.naturalWidth||c.width,u.height=c.naturalHeight||c.height;const l=u.getContext("2d");l.drawImage(c,0,0,u.width,u.height);const g=l.getImageData(0,0,u.width,u.height),C=yield zbarWasm.scanImageData(g);if(C&&C.length){C.forEach(y=>y.value=y.decode(e&&e.toLocaleLowerCase())),((r,n)=>{let e=n.getContext("2d",{willReadFrequently:!0});for(let t=0;t<r.length;t++){const o=r[t];let i={},a=[],c=[];const u=o.points;for(let h=0;h<u.length;h++){const R=A(u,`${h}.x`)?u[h].x:0,y=A(u,`${h}.y`)?u[h].y:0;i[`x${h+1}`]=R,i[`y${h+1}`]=y,a.push(R),c.push(y)}let l=Math.min(...a),g=Math.min(...c);e.lineWidth=1,e.strokeStyle="green",e.fillStyle="#55f02880",e.font="15px serif",Te(e,o.value,l,g-5);const C=[];for(let h=0;h<a.length;h++)C.push(i[`x${h+1}`]),C.push(i[`y${h+1}`]);const _=C.slice(0);for(e.beginPath(),e.moveTo(_.shift(),_.shift());_.length;)e.lineTo(_.shift(),_.shift());e.closePath(),e.fill(),e.stroke()}})(C,u);const _=yield pe(u),h=URL.createObjectURL(_);t(Object.assign({},a,{data:C,url:h,canvas:u,file:(y=_,H=a.name,new File([y],H,{lastModified:(new Date).getTime(),type:y.type}))}))}else t(Object.assign({},a,{data:C,canvas:u}));var y,H}),c.src=a.url},i.onerror=a=>o(a),i.readAsDataURL(r)})})(t,n))).then(t=>{f(e,t),ne(!A(n,"isBeep")||n.isBeep)}).catch(t=>f(e,null,t)),e),Te=(r,n,e,t)=>{let o=1.2*r.measureText("M").width,i=n.split("\n");for(var a=0;a<i.length;++a)r.fillText(i[a],e,t),r.strokeText(i[a],e,t),t+=o},ve=r=>{r&&xe()&&window&&window.navigator&&window.navigator.vibrate(r)},xe=()=>{const r=navigator.userAgent||navigator.vendor||window.opera;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(r)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(r.substr(0,4))||/^((?!chrome|android).)*safari/i.test(r))};class Q{loadFiles(n=[]){const e=new O;return Promise.all(Object.assign([],n).map(t=>this.readAsDataURL(t))).then(t=>f(e,t)).catch(t=>f(e,null,t)),e}loadFilesToScan(n=[],e){return me(n,e)}readAsDataURL(n){return new Promise((e,t)=>{const o=new FileReader;o.onload=()=>{const i={name:n.name,file:n,url:URL.createObjectURL(n)};e(i)},o.onerror=i=>t(i),o.readAsDataURL(n)})}}Q.\u0275fac=function(n){return new(n||Q)},Q.\u0275prov=E.Yz7({token:Q,factory:Q.\u0275fac,providedIn:"root"}),Q.ngInjectableDef=(0,E.Ez6)({factory:function(){return new Q},token:Q,providedIn:"root"});let Ie=(()=>{class r{constructor(e){this.renderer=e,this.event=new E.vpe,this.src=N.src,this.fps=N.fps,this.vibrate=N.vibrate,this.decode=N.decode,this.isBeep=N.isBeep,this.deviceActive=N.deviceActive,this.config=N,this.constraints=N.constraints,this.isStart=!1,this.isLoading=!1,this.isTorch=!1,this.data=new he.X([]),this.devices=new he.X([]),this.dataForResize=[],this.ready=new O,this.wasmRemote="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@latest/wasm/index.js",this.wasmProject="assets/wasm/index.js"}ngOnInit(){this.overrideConfig(),this.addJsToElement().subscribe(()=>{this.src&&this.loadImage(this.src),this.resize()})}addJsToElement(){if(document.querySelectorAll(`script[src="${this.wasmRemote}"]`).length)setTimeout(()=>f(this.ready,!0),0);else{document.querySelectorAll(`script[src="${this.wasmProject}"]`).forEach(i=>i.remove());const o=this.renderer.createElement("script");this.renderer.setAttribute(o,"type","text/javascript"),this.renderer.setAttribute(o,"src",this.wasmProject),this.renderer.appendChild(document.body,o),o.onload=()=>setTimeout(()=>f(this.ready,!0),100),o.onerror=()=>setTimeout(()=>f(this.ready,!1,!0),100)}return this.ready}start(){const e=new O;return this.isStart?f(e,!1):this.safariWebRTC(e),e}playDevice(e,t=new O){const o=!this.isStart||this.getConstraints().deviceId!=e;switch(!0){case"null"==e||null==e:stop(),this.stop(),f(t,!1);break;case e&&o:stop(),this.stop(!1,!1),clearInterval(this.rAF_ID),this.status(!1,!0),this.deviceActive=this.devices.value.findIndex(a=>a.deviceId==e);const i=Object.assign({},this.constraints,{audio:!1,video:Object.assign({deviceId:e},this.constraints.video)});navigator.mediaDevices.getUserMedia(i).then(a=>{this.video.nativeElement.srcObject=a,this.video.nativeElement.onloadedmetadata=()=>{this.video.nativeElement.play(),this.requestAnimationFrame(),this.status(!0,!1),f(t,!0)}}).catch(a=>{this.status(!1,!1),this.eventEmit(!1),f(t,!1,a)});break;default:this.status(this.isStart,!1),f(t,!1)}return t}stop(e=!0,t=!0){e&&this.eventEmit(null),t&&this.status(!1,!1);const o=new O;try{this.removeCanvas(),clearInterval(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(i=>{i.stop(),f(o,!0)})}catch(i){f(o,!1,i)}return o}play(){const e=new O;return this.isPause?(this.video.nativeElement.play(),this.requestAnimationFrame(),f(e,!0)):f(e,!1),e}pause(){const e=new O;return this.isStart?(clearInterval(this.rAF_ID),this.video.nativeElement.pause(),f(e,!0)):f(e,!1),e}loadImage(e){const t=new O;this.status(!1,!0);const o=new Image;return o.setAttribute("crossOrigin","anonymous"),o.onload=()=>{this.drawImage(o,i=>{this.status(!1,!1),f(t,i)})},o.src=e,t}torcher(){const e=this.applyConstraints({advanced:[{torch:this.isTorch}]});return e.subscribe(()=>!1,()=>this.isTorch=!this.isTorch),e}applyConstraints(e){const t=new O,i=this.video.nativeElement.srcObject.getVideoTracks()[0];return new window.ImageCapture(i).getPhotoCapabilities().then(()=>T(this,void 0,void 0,function*(){yield i.applyConstraints(e),f(t,!0)})).catch(c=>{switch(c&&c.name){case"NotFoundError":case"DevicesNotFoundError":f(t,!1,"Required track is missing");break;case"NotReadableError":case"TrackStartError":f(t,!1,"Webcam or mic are already in use");break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":f(t,!1,"Constraints can not be satisfied by avb. devices");break;case"NotAllowedError":case"PermissionDeniedError":f(t,!1,"Permission denied in browser");break;case"TypeError":f(t,!1,"Empty constraints object");break;default:f(t,!1,c)}}),t}getConstraints(){const e=this.video.nativeElement.srcObject,t=e&&e.getVideoTracks()[0];return t&&t.getConstraints()}download(e=`ngx-scanner-qrcode-${Date.now()}.png`){const t=new O;return(()=>{T(this,void 0,void 0,function*(){const a=((r,n)=>new File([r],n,{lastModified:(new Date).getTime(),type:r.type}))(yield pe(this.canvas.nativeElement),e);me([a],this.config,t).subscribe(c=>{c.forEach(u=>{const l=document.createElement("a");l.href=u.url,l.download=u.name,l.click(),l.remove()})})})})(),t}resize(){window.addEventListener("resize",()=>{this.dataForResize&&this.dataForResize.length&&fe(this.dataForResize,this.canvas.nativeElement,this.resultsPanel.nativeElement)})}overrideConfig(){A(this.config,"src")&&(this.src=this.config.src),A(this.config,"fps")&&(this.fps=this.config.fps),A(this.config,"vibrate")&&(this.vibrate=this.config.vibrate),A(this.config,"decode")&&(this.decode=this.config.decode),A(this.config,"isBeep")&&(this.isBeep=this.config.isBeep),A(this.config,"deviceActive")&&(this.deviceActive=this.config.deviceActive),A(this.config,"constraints")&&(this.constraints=((r,n,e)=>{if(n&&Object.keys(n[r]).length){for(const t in e){const o=JSON.parse(JSON.stringify(Object.assign({},n[r],{[t]:e[t]})));n[r]=n[r].hasOwnProperty(t)?n[r]:o}return n[r]}return e})("constraints",this.config,_e))}safariWebRTC(e){this.status(!1,!0),navigator.mediaDevices.getUserMedia(this.constraints).then(t=>{t.getTracks().forEach(o=>o.stop()),this.loadAllDevices(e)}).catch(t=>{this.status(!1,!1),f(e,!1,t)})}loadAllDevices(e){navigator.mediaDevices.enumerateDevices().then(t=>{let o=[];if(t.forEach(i=>"videoinput"==i.kind&&o.push(i)),this.devices.next(o),o.length>0){const i=Math.max(0,o.length>this.deviceActive?this.deviceActive:0);this.playDevice(o[i].deviceId,e)}else this.status(!1,!1),f(e,!1,"No camera detected.")}).catch(t=>{this.status(!1,!1),f(e,!1,t)})}drawImage(e,t=(()=>{})){return T(this,void 0,void 0,function*(){const o=this.canvas.nativeElement,i=o.getContext("2d",{willReadFrequently:!0});e instanceof HTMLImageElement&&(o.width=e.naturalWidth,o.height=e.naturalHeight,e.style.visibility="",this.video.nativeElement.style.visibility="hidden",this.video.nativeElement.style.height=o.offsetHeight+"px"),e instanceof HTMLVideoElement&&(o.width=e.videoWidth,o.height=e.videoHeight,e.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),i.clearRect(0,0,o.width,o.height),i.drawImage(e,0,0,o.width,o.height);const a=i.getImageData(0,0,o.width,o.height),c=yield zbarWasm.scanImageData(a);if(c&&c.length){c.forEach(l=>l.value=l.decode(this.decode&&this.decode.toLocaleLowerCase())),fe(c,Object.freeze(this.canvas.nativeElement),this.resultsPanel.nativeElement);const u=()=>{this.eventEmit(c),this.dataForResize=c};e instanceof HTMLImageElement&&(t(!0),u(),ve(this.vibrate),ne(this.isBeep)),e instanceof HTMLVideoElement&&(u(),ve(this.vibrate),ne(this.isBeep))}else t(!1),this.removeCanvas(),this.dataForResize=c})}removeCanvas(){Object.assign([],this.resultsPanel.nativeElement.childNodes).forEach(e=>this.resultsPanel.nativeElement.removeChild(e))}status(e,t){this.isStart=e,this.isLoading=t}eventEmit(e=!1){!1!==e&&this.data.next(e||{data:null}),!1!==e&&this.event.emit(e||{data:null})}requestAnimationFrame(){this.rAF_ID=setInterval(()=>{this.video.nativeElement.readyState===this.video.nativeElement.HAVE_ENOUGH_DATA&&this.drawImage(this.video.nativeElement)},this.fps)}get isPause(){return this.isStart&&this.video.nativeElement.paused}get isReady(){return this.ready}ngOnDestroy(){this.pause()}}return r.\u0275fac=function(e){return new(e||r)(E.Y36(E.Qsj))},r.\u0275cmp=E.Xpm({type:r,selectors:[["ngx-scanner-qrcode"]],viewQuery:function(e,t){if(1&e&&(E.Gf(ye,5),E.Gf(Ae,5),E.Gf(we,5)),2&e){let o;E.iGM(o=E.CRH())&&(t.video=o.first),E.iGM(o=E.CRH())&&(t.canvas=o.first),E.iGM(o=E.CRH())&&(t.resultsPanel=o.first)}},hostAttrs:[1,"ngx-scanner-qrcode"],inputs:{src:"src",fps:"fps",vibrate:"vibrate",decode:"decode",isBeep:"isBeep",deviceActive:"deviceActive",config:"config",constraints:"constraints"},outputs:{event:"event"},exportAs:["scanner"],decls:6,vars:0,consts:[[1,"origin-overlay"],["resultsPanel",""],[1,"origin-canvas"],["canvas",""],["playsinline","",1,"origin-video"],["video",""]],template:function(e,t){1&e&&E._UZ(0,"div",0,1)(2,"canvas",2,3)(4,"video",4,5)},styles:[".ngx-scanner-qrcode{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;color:red;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute}.qrcode-tooltip-temp{bottom:0;left:50%;padding:5px;color:#fff;text-align:left;display:none;max-width:450px;border-radius:5px;width:-moz-max-content;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}.qrcode-tooltip-temp .qrcode-tooltip-clipboard{cursor:pointer;margin-left:5px;fill:#fff}.qrcode-tooltip-temp .qrcode-tooltip-clipboard:active{fill:#afafaf}"],encapsulation:2}),r})();const d={ScannerQRCode_NONE:0,ScannerQRCode_PARTIAL:1,ScannerQRCode_EAN2:2,ScannerQRCode_EAN5:5,ScannerQRCode_EAN8:8,ScannerQRCode_UPCE:9,ScannerQRCode_ISBN10:10,ScannerQRCode_UPCA:12,ScannerQRCode_EAN13:13,ScannerQRCode_ISBN13:14,ScannerQRCode_COMPOSITE:15,ScannerQRCode_I25:25,ScannerQRCode_DATABAR:34,ScannerQRCode_DATABAR_EXP:35,ScannerQRCode_CODABAR:38,ScannerQRCode_CODE39:39,ScannerQRCode_PDF417:57,ScannerQRCode_QRCODE:64,ScannerQRCode_SQCODE:80,ScannerQRCode_CODE93:93,ScannerQRCode_CODE128:128,ScannerQRCode_SYMBOL:255,ScannerQRCode_ADDON2:512,ScannerQRCode_ADDON5:1280,ScannerQRCode_ADDON:1792};d[d.ScannerQRCode_NONE]="ScannerQRCode_NONE",d[d.ScannerQRCode_PARTIAL]="ScannerQRCode_PARTIAL",d[d.ScannerQRCode_EAN2]="ScannerQRCode_EAN2",d[d.ScannerQRCode_EAN5]="ScannerQRCode_EAN5",d[d.ScannerQRCode_EAN8]="ScannerQRCode_EAN8",d[d.ScannerQRCode_UPCE]="ScannerQRCode_UPCE",d[d.ScannerQRCode_ISBN10]="ScannerQRCode_ISBN10",d[d.ScannerQRCode_UPCA]="ScannerQRCode_UPCA",d[d.ScannerQRCode_EAN13]="ScannerQRCode_EAN13",d[d.ScannerQRCode_ISBN13]="ScannerQRCode_ISBN13",d[d.ScannerQRCode_COMPOSITE]="ScannerQRCode_COMPOSITE",d[d.ScannerQRCode_I25]="ScannerQRCode_I25",d[d.ScannerQRCode_DATABAR]="ScannerQRCode_DATABAR",d[d.ScannerQRCode_DATABAR_EXP]="ScannerQRCode_DATABAR_EXP",d[d.ScannerQRCode_CODABAR]="ScannerQRCode_CODABAR",d[d.ScannerQRCode_CODE39]="ScannerQRCode_CODE39",d[d.ScannerQRCode_PDF417]="ScannerQRCode_PDF417",d[d.ScannerQRCode_QRCODE]="ScannerQRCode_QRCODE",d[d.ScannerQRCode_SQCODE]="ScannerQRCode_SQCODE",d[d.ScannerQRCode_CODE93]="ScannerQRCode_CODE93",d[d.ScannerQRCode_CODE128]="ScannerQRCode_CODE128",d[d.ScannerQRCode_SYMBOL]="ScannerQRCode_SYMBOL",d[d.ScannerQRCode_ADDON2]="ScannerQRCode_ADDON2",d[d.ScannerQRCode_ADDON5]="ScannerQRCode_ADDON5",d[d.ScannerQRCode_ADDON]="ScannerQRCode_ADDON";const v={ScannerQRCode_CFG_ENABLE:0,ScannerQRCode_CFG_ADD_CHECK:1,ScannerQRCode_CFG_EMIT_CHECK:2,ScannerQRCode_CFG_ASCII:3,ScannerQRCode_CFG_BINARY:4,ScannerQRCode_CFG_NUM:5,ScannerQRCode_CFG_MIN_LEN:32,ScannerQRCode_CFG_MAX_LEN:33,ScannerQRCode_CFG_UNCERTAINTY:64,ScannerQRCode_CFG_POSITION:128,ScannerQRCode_CFG_TEST_INVERTED:129,ScannerQRCode_CFG_X_DENSITY:256,ScannerQRCode_CFG_Y_DENSITY:257};v[v.ScannerQRCode_CFG_ENABLE]="ScannerQRCode_CFG_ENABLE",v[v.ScannerQRCode_CFG_ADD_CHECK]="ScannerQRCode_CFG_ADD_CHECK",v[v.ScannerQRCode_CFG_EMIT_CHECK]="ScannerQRCode_CFG_EMIT_CHECK",v[v.ScannerQRCode_CFG_ASCII]="ScannerQRCode_CFG_ASCII",v[v.ScannerQRCode_CFG_BINARY]="ScannerQRCode_CFG_BINARY",v[v.ScannerQRCode_CFG_NUM]="ScannerQRCode_CFG_NUM",v[v.ScannerQRCode_CFG_MIN_LEN]="ScannerQRCode_CFG_MIN_LEN",v[v.ScannerQRCode_CFG_MAX_LEN]="ScannerQRCode_CFG_MAX_LEN",v[v.ScannerQRCode_CFG_UNCERTAINTY]="ScannerQRCode_CFG_UNCERTAINTY",v[v.ScannerQRCode_CFG_POSITION]="ScannerQRCode_CFG_POSITION",v[v.ScannerQRCode_CFG_TEST_INVERTED]="ScannerQRCode_CFG_TEST_INVERTED",v[v.ScannerQRCode_CFG_X_DENSITY]="ScannerQRCode_CFG_X_DENSITY",v[v.ScannerQRCode_CFG_Y_DENSITY]="ScannerQRCode_CFG_Y_DENSITY";const D={ScannerQRCode_ORIENT_UNKNOWN:-1,ScannerQRCode_ORIENT_UP:0,ScannerQRCode_ORIENT_RIGHT:1,ScannerQRCode_ORIENT_DOWN:2,ScannerQRCode_ORIENT_LEFT:3};D[D.ScannerQRCode_ORIENT_UNKNOWN]="ScannerQRCode_ORIENT_UNKNOWN",D[D.ScannerQRCode_ORIENT_UP]="ScannerQRCode_ORIENT_UP",D[D.ScannerQRCode_ORIENT_RIGHT]="ScannerQRCode_ORIENT_RIGHT",D[D.ScannerQRCode_ORIENT_DOWN]="ScannerQRCode_ORIENT_DOWN",D[D.ScannerQRCode_ORIENT_LEFT]="ScannerQRCode_ORIENT_LEFT";let Ne=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=E.oAB({type:r}),r.\u0275inj=E.cJS({providers:[Q]}),r})()}}]);